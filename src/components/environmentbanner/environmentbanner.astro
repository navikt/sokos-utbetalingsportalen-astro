---
import styles from './environmentbanner.module.css';

type ApplicationEnvironment = 'QX' | 'Q1' | null;

function getApplicationEnvironment(): ApplicationEnvironment | string {
  if (!process.env.WONDERWALL_INGRESS) {
    return 'LOCAL';
  }

  const ingress = process.env.WONDERWALL_INGRESS.split(',')[0];

  // Check if running in dev-gcp cluster using NAIS_CLUSTER_NAME
  const isDevGcp = process.env.NAIS_CLUSTER_NAME === 'dev-gcp';

  // Only proceed with environment detection if in dev-gcp
  if (!isDevGcp) {
    return null; // Don't show banner in other clusters
  }

  // First try to match environment with dash pattern: astro-{env}.
  const envMatch = ingress.match(/astro-([^.]+)\./);
  if (envMatch && envMatch[1]) {
    // Return the environment identifier (qx, q2, q3, etc.)
    return `TEST ${envMatch[1]}`;
  }

  // If no dash pattern but contains "astro." without environment, it's q1
  if (ingress.match(/astro\./)) {
    return 'TEST Q1';
  }

  return '';
}

const environment = getApplicationEnvironment();
---

<div class={styles.banner}>
  <svg
    aria-hidden="true"
    role="img"
    xmlns="http://www.w3.org/2000/svg"
    height="110"
    width="110"
    class={styles.bannerIcon}
  >
    <polygon points="0,0 110,0 110,110"></polygon>
    <text x="25" y="10" transform="rotate(45 20,40)">
      {environment}
    </text>
  </svg>
</div>
